<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Secret Santa Hints üéÅ</title>

  <!-- Retro-ish pixel font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#0b1026;
      --bg2:#1f2a6b;
      --card:#0f163aee;
      --card2:#101a46ee;
      --glow:#7df3ff;
      --text:#eaf1ff;
      --muted:#b8c6ff;
      --good:#63ffb5;
      --warn:#ffd56a;
      --hot:#ff6ad5;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background: radial-gradient(1200px 700px at 30% 10%, #2c49ff33 0%, transparent 60%),
                  radial-gradient(900px 600px at 80% 20%, #ff6ad533 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg2) 0%, var(--bg1) 65%, #070a18 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* Full-screen pixel scene */
    .scene-wrap{
      position:fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
    }
    canvas#scene{
      width:100%;
      height:100%;
      display:block;
      image-rendering: pixelated;
      opacity:1;
    }

    /* Content layout */
    .app{
      position:relative;
      z-index:2;
      min-height:100%;
      padding: clamp(14px, 3vw, 22px);
      /* EXTRA SKY SPACE for the pets to run around */
      padding-top: clamp(64px, 8vw, 96px);
      padding-bottom: 28px;
      max-width: 880px;
      margin: 0 auto;
    }

    header{
      margin-top: 0;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }

    .titleCard{
      flex:1;
      background: linear-gradient(180deg, #122060dd 0%, #0e1538dd 100%);
      border:1px solid #2a3b9a66;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }
    .titleCard:before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(600px 220px at 10% 0%, rgba(125,243,255,.22), transparent 60%),
        radial-gradient(520px 220px at 80% 20%, rgba(255,106,213,.18), transparent 60%);
      pointer-events:none;
    }

    h1{
      margin:0;
      font-family: "Press Start 2P", system-ui, sans-serif;
      font-size: clamp(14px, 3.6vw, 20px);
      line-height: 1.35;
      letter-spacing: .3px;
      text-shadow: 0 0 20px rgba(125,243,255,.18);
      position:relative;
      z-index:1;
    }
    .subtitle{
      margin:10px 0 2px;
      color:var(--muted);
      font-size: 13px;
      line-height:1.45;
      position:relative;
      z-index:1;
    }

    .badgeRow{
      margin-top: 12px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      position:relative;
      z-index:1;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid #2a3b9a88;
      background: rgba(10, 14, 35, .55);
      font-size: 12px;
      color: var(--text);
      box-shadow: 0 8px 20px rgba(0,0,0,.18);
      white-space:nowrap;
    }
    .badge .dot{
      width:10px;height:10px;border-radius:2px;
      background: var(--glow);
      box-shadow: 0 0 10px rgba(125,243,255,.45);
    }

    .controls{
      width: 172px;
      flex: 0 0 172px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .miniCard{
      background: linear-gradient(180deg, #0f163add 0%, #0b1026dd 100%);
      border:1px solid #2a3b9a66;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px;
      backdrop-filter: blur(10px);
    }
    .miniTitle{
      font-size:12px;
      color:var(--muted);
      margin:0 0 8px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .btn{
      width:100%;
      appearance:none;
      border:none;
      border-radius: 14px;
      padding: 10px 12px;
      font-weight: 700;
      cursor:pointer;
      color:#091026;
      background: linear-gradient(180deg, #7df3ff 0%, #53d8ff 100%);
      box-shadow: 0 12px 24px rgba(0,0,0,.22), 0 0 0 1px #7df3ff55 inset;
    }
    .btn:active{transform: translateY(1px)}
    .btn.secondary{
      background: linear-gradient(180deg, #ff6ad5 0%, #ff3dbd 100%);
      color:#190818;
      box-shadow: 0 12px 24px rgba(0,0,0,.22), 0 0 0 1px #ff6ad555 inset;
    }
    .btn.ghost{
      background: rgba(255,255,255,.06);
      color: var(--text);
      border:1px solid #2a3b9a88;
      box-shadow:none;
    }

    main{
      margin-top: 14px;
      display:grid;
      gap: 14px;
      grid-template-columns: 1fr;
    }

    .panel{
      background: linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      border:1px solid #2a3b9a66;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }
    .panel:after{
      content:"";
      position:absolute;
      bottom:-80px; right:-90px;
      width: 260px; height: 260px;
      background: radial-gradient(circle at 30% 30%, rgba(99,255,181,.14), transparent 62%);
      pointer-events:none;
      transform: rotate(25deg);
    }

    .panel h2{
      margin: 0 0 10px;
      font-size: 14px;
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      position:relative;
      z-index:1;
    }

    .hint{
      margin:0 0 10px;
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
      position:relative;
      z-index:1;
    }

    .grid{
      display:grid;
      gap: 12px;
      grid-template-columns: 1fr;
      position:relative;
      z-index:1;
    }

    .gift{
      border-radius: 18px;
      border: 1px solid #2a3b9a88;
      background: rgba(10, 14, 35, .38);
      padding: 12px;
      display:flex;
      gap: 12px;
      align-items:flex-start;
      transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
      cursor:pointer;
      user-select:none;
    }
    .gift:hover{ transform: translateY(-1px); box-shadow: 0 16px 28px rgba(0,0,0,.22); }
    .gift.selected{
      border-color: rgba(125,243,255,.95);
      box-shadow: 0 0 0 1px rgba(125,243,255,.35) inset, 0 18px 40px rgba(0,0,0,.26);
    }

    .icon{
      width: 54px;
      height: 54px;
      border-radius: 14px;
      background: radial-gradient(circle at 25% 25%, rgba(255,255,255,.14), transparent 64%),
                  linear-gradient(180deg, rgba(125,243,255,.22), rgba(255,106,213,.12));
      border:1px solid rgba(125,243,255,.22);
      display:grid;
      place-items:center;
      flex: 0 0 54px;
    }
    .pixel{
      width: 26px; height: 26px;
      image-rendering: pixelated;
      filter: drop-shadow(0 0 10px rgba(125,243,255,.25));
    }

    .gift h3{ margin:0; font-size: 14px; line-height:1.25; }
    .gift p{ margin: 6px 0 0; color: var(--muted); font-size: 12.5px; line-height: 1.45; }

    .metaRow{
      margin-top: 10px;
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      align-items:center;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid #2a3b9a88;
      background: rgba(255,255,255,.06);
      font-size: 12px;
      color: var(--text);
      white-space:nowrap;
    }
    .pill b{font-weight: 800}
    .pill.good{ border-color: rgba(99,255,181,.45); }
    .pill.warn{ border-color: rgba(255,213,106,.45); }
    .pill.hot{ border-color: rgba(255,106,213,.55); }

    .linkRow{
      margin-top: 10px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 9px 10px;
      border-radius: 14px;
      border: 1px solid #2a3b9a88;
      background: rgba(255,255,255,.06);
      color: var(--text);
      text-decoration:none;
      font-weight:700;
      font-size: 12px;
    }
    .a:active{transform: translateY(1px)}
    .a.primary{
      border-color: rgba(125,243,255,.55);
      background: rgba(125,243,255,.14);
    }

    .noteBox{
      margin-top: 12px;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px dashed rgba(125,243,255,.35);
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.45;
      background: rgba(0,0,0,.12);
      position:relative;
      z-index:1;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(10,14,35,.88);
      border: 1px solid #2a3b9a88;
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: 0 16px 36px rgba(0,0,0,.34);
      color: var(--text);
      font-weight: 800;
      font-size: 12px;
      opacity: 0;
      pointer-events:none;
      z-index: 9999;
      backdrop-filter: blur(10px);
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show{opacity:1; transform: translateX(-50%) translateY(-4px);}

    @media (min-width: 760px){
      main{grid-template-columns: 1.1fr .9fr;}
      .controls{width: 220px; flex-basis:220px;}
    }

    @media (prefers-reduced-motion: reduce){
      .gift:hover{transform:none}
      .btn:active{transform:none}
    }
  </style>

  <!-- 3rd-party libs (optional) -->
  <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
</head>

<body>
  <div class="scene-wrap" aria-hidden="true">
    <canvas id="scene"></canvas>
  </div>

  <div class="app">
    <header>
      <div class="titleCard">
        <h1>SECRET SANTA HINTS<br/>‚ú® Retro Edition ‚ú®</h1>
        <p class="subtitle">
          Scan. Smile. Deploy gifts gently.<br/>
          Budget limit: <b>AED 100 max</b> (hard cap ‚Äî the laws of physics demand it).
        </p>
        <div class="badgeRow">
          <span class="badge"><span class="dot"></span> Pixel pets</span>
          <span class="badge"><span class="dot" style="background:var(--good)"></span> Linux vibes</span>
          <span class="badge"><span class="dot" style="background:var(--hot)"></span> Tiny computers</span>
        </div>
      </div>

      <div class="controls">
        <div class="miniCard">
          <div class="miniTitle">
            <span>Party controls</span>
            <span id="fps" title="approx FPS" style="font-weight:900;color:var(--muted);font-size:11px;">‚Äî</span>
          </div>
          <button class="btn" id="btnConfetti">üéâ Spawn confetti</button>
          <button class="btn secondary" id="btnFeed">üç¨ Feed the critters</button>
          <button class="btn ghost" id="btnToggleAnimals">üêæ Toggle animals</button>
        </div>
      </div>
    </header>

    <main>
      <section class="panel">
        <h2>My top picks (all &lt; AED 100) <span class="pill warn">Tap to highlight</span></h2>
        <p class="hint">
          Any one of these makes me happy. Zero pressure, maximum festive chaos.
        </p>

        <div class="grid" id="giftGrid">
          <!-- Gift 1 -->
          <article class="gift" data-id="tama" tabindex="0" role="button" aria-label="Select Tamagotchi hint">
            <div class="icon" aria-hidden="true">
              <svg class="pixel" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                <rect width="16" height="16" fill="none"/>
                <rect x="4" y="2" width="8" height="2" fill="#7df3ff"/>
                <rect x="3" y="4" width="10" height="9" rx="1" fill="#ff6ad5"/>
                <rect x="5" y="6" width="2" height="2" fill="#0b1026"/>
                <rect x="9" y="6" width="2" height="2" fill="#0b1026"/>
                <rect x="6" y="9" width="4" height="2" fill="#0b1026"/>
                <rect x="6" y="12" width="4" height="1" fill="#7df3ff"/>
              </svg>
            </div>
            <div>
              <h3>1) Tamagotchi (or any cute retro virtual pet)</h3>
              <p>
                I‚Äôm into that classic pixel-pet vibe. Bonus points if it feels nostalgic and pocket-sized.
              </p>
              <div class="metaRow">
                <span class="pill good">‚úÖ <b>Under</b> AED 100</span>
                <span class="pill hot">üéÆ Retro</span>
                <span class="pill warn">üß† Low-maintenance chaos</span>
              </div>
              <div class="linkRow">
                <a class="a primary" target="_blank" rel="noopener" href="https://www.amazon.ae/s?k=tamagotchi">Amazon search</a>
                <a class="a" href="#" data-copy="tamagotchi" aria-label="Copy search keyword">Copy keyword</a>
              </div>
            </div>
          </article>

          <!-- Gift 2 -->
          <article class="gift" data-id="mousepad" tabindex="0" role="button" aria-label="Select Linux command line mousepad hint">
            <div class="icon" aria-hidden="true">
              <svg class="pixel" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                <rect width="16" height="16" fill="none"/>
                <rect x="2" y="3" width="12" height="10" rx="2" fill="#7df3ff"/>
                <rect x="3" y="4" width="10" height="8" rx="1" fill="#0b1026"/>
                <rect x="4" y="6" width="6" height="1" fill="#63ffb5"/>
                <rect x="4" y="8" width="7" height="1" fill="#ffd56a"/>
                <rect x="4" y="10" width="5" height="1" fill="#ff6ad5"/>
              </svg>
            </div>
            <div>
              <h3>2) Linux Command Line Mousepad</h3>
              <p>
                A desk upgrade that whispers: ‚ÄúI use <code>grep</code> for fun.‚Äù Practical + nerdy = perfect.
              </p>
              <div class="metaRow">
                <span class="pill good">‚úÖ <b>Under</b> AED 100</span>
                <span class="pill hot">üêß Linux</span>
                <span class="pill warn">üñ±Ô∏è Daily use</span>
              </div>
              <div class="linkRow">
                <a class="a primary" target="_blank" rel="noopener" href="https://www.amazon.ae/s?k=linux+command+mousepad">Amazon search</a>
                <a class="a" href="#" data-copy="linux command line mousepad" aria-label="Copy search keyword">Copy keyword</a>
              </div>
            </div>
          </article>

          <!-- Gift 3 -->
          <article class="gift" data-id="pi" tabindex="0" role="button" aria-label="Select Raspberry Pi board only hint">
            <div class="icon" aria-hidden="true">
              <svg class="pixel" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                <rect width="16" height="16" fill="none"/>
                <rect x="3" y="3" width="10" height="10" rx="2" fill="#63ffb5"/>
                <rect x="5" y="5" width="6" height="6" rx="1" fill="#0b1026"/>
                <rect x="2" y="6" width="2" height="1" fill="#ffd56a"/>
                <rect x="2" y="8" width="2" height="1" fill="#ffd56a"/>
                <rect x="12" y="6" width="2" height="1" fill="#ff6ad5"/>
                <rect x="12" y="8" width="2" height="1" fill="#ff6ad5"/>
              </svg>
            </div>
            <div>
              <h3>3) Raspberry Pi (board only) ‚Äî &lt; AED 100</h3>
              <p>
                Just the board is great. I like tinkering, building small projects, and generally summoning computers from dust.
              </p>
              <div class="metaRow">
                <span class="pill warn">‚ö†Ô∏è <b>Must be</b> under AED 100</span>
                <span class="pill hot">üß™ Tinkering</span>
                <span class="pill good">üîå Tiny computer</span>
              </div>
              <div class="linkRow">
                <a class="a primary" target="_blank" rel="noopener" href="https://www.amazon.ae/s?k=raspberry+pi+board">Amazon search</a>
                <a class="a" href="#" data-copy="raspberry pi board only" aria-label="Copy search keyword">Copy keyword</a>
              </div>
            </div>
          </article>
        </div>

        <div class="noteBox" id="selectionBox">
          Tip: tap a gift card to ‚Äúlock in‚Äù the hint glow. The animals will celebrate your choice (they‚Äôre very employed).
        </div>
      </section>

      <!-- QR panel removed; link-only panel -->
      <aside class="panel">
        <h2>Share this page (link only)</h2>
        <p class="hint">
          Open this page on your phone and copy the link below. That‚Äôs it ‚Äî clean, simple, zero QR drama.
        </p>

        <div class="noteBox" style="display:flex;flex-direction:column;gap:10px;">
          <div style="font-size:12px;color:var(--muted);line-height:1.35;">
            <b>Link:</b><br/>
            <span id="linkText" style="word-break:break-all;color:var(--text);font-weight:800;"></span>
          </div>
          <button class="btn" id="btnCopyLink">üîó Copy link</button>
          <button class="btn ghost" id="btnOpenAmazon">üõí Open Amazon.ae</button>
        </div>

        <div class="noteBox">
          <b>Budget rule:</b> every option must be <b>AED 100 or less</b>. If it‚Äôs over, the pixel pets will file a ticket.
        </div>
      </aside>
    </main>
  </div>

  <div class="toast" id="toast">Copied ‚úÖ</div>

  <script>
    // ----------------------------
    // Tiny helpers
    // ----------------------------
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => [...el.querySelectorAll(s)];

    function toast(msg="Done ‚úÖ"){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=> t.classList.remove("show"), 1400);
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("Copied ‚úÖ");
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("Copied ‚úÖ");
      }
    }

    // ----------------------------
    // Gift selection UI
    // ----------------------------
    const selectionBox = $("#selectionBox");
    const giftCards = $$(".gift");

    function selectGift(card){
      giftCards.forEach(c => c.classList.remove("selected"));
      card.classList.add("selected");

      const id = card.dataset.id;
      const lines = {
        tama: "Selected: Tamagotchi / retro virtual pet. ‚úÖ Pocket nostalgia activated.",
        mousepad: "Selected: Linux command line mousepad. ‚úÖ Desk buff: +10 productivity (maybe).",
        pi: "Selected: Raspberry Pi board only. ‚úÖ Tinker-mode engaged (under AED 100!)."
      };
      selectionBox.innerHTML = `
        <b>${lines[id] || "Selected ‚úÖ"}</b><br/>
        Tiny creatures have been notified. Expect celebratory jumping.
      `;

      if (window.confetti){
        confetti({ particleCount: 70, spread: 60, origin: { y: 0.72 } });
      }
      boostZoomies(1.25);
    }

    giftCards.forEach(card=>{
      card.addEventListener("click", ()=> selectGift(card));
      card.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){ e.preventDefault(); selectGift(card); }
      });
    });

    // Copy keyword buttons
    $$("[data-copy]").forEach(a=>{
      a.addEventListener("click",(e)=>{
        e.preventDefault();
        copyText(a.getAttribute("data-copy"));
      });
    });

    // ----------------------------
    // Link-only share panel
    // ----------------------------
    function updateLinkText(){
      $("#linkText").textContent = window.location.href;
    }

    $("#btnCopyLink").addEventListener("click", ()=> copyText(window.location.href));
    $("#btnOpenAmazon").addEventListener("click", ()=> window.open("https://www.amazon.ae", "_blank", "noopener"));

    // ----------------------------
    // Pixel critter world (canvas)
    // ----------------------------
    const canvas = $("#scene");
    const ctx = canvas.getContext("2d", { alpha: true });

    let W = 0, H = 0, DPR = 1;
    function resize(){
      DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      W = Math.floor(window.innerWidth);
      H = Math.floor(window.innerHeight);
      canvas.width = Math.floor(W * DPR);
      canvas.height = Math.floor(H * DPR);
      canvas.style.width = W + "px";
      canvas.style.height = H + "px";
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener("resize", resize, { passive: true });
    resize();

    const world = {
      showAnimals: true,
      sparkles: [],
      critters: [],
      clouds: [],
      zoomies: 1.0
    };

    const palettes = [
      { body:"#7df3ff", accent:"#ff6ad5", eye:"#0b1026", blush:"#ffd56a" },
      { body:"#63ffb5", accent:"#ffd56a", eye:"#0b1026", blush:"#ff6ad5" },
      { body:"#ff6ad5", accent:"#7df3ff", eye:"#0b1026", blush:"#63ffb5" },
    ];

    function rand(min,max){ return Math.random()*(max-min)+min; }
    function randi(min,max){ return Math.floor(rand(min,max+1)); }

    function addCloud(){
      world.clouds.push({
        x: rand(-120, W+120),
        y: rand(30, H*0.28),
        s: rand(0.9, 1.9),
        v: rand(0.18, 0.60)
      });
    }

    // Critters now live in the TOP "sky lane" so you can actually see them
    function skyLaneY(){
      const minY = 28;
      const maxY = Math.max(70, Math.floor(H*0.22));
      return randi(minY, maxY);
    }

    function addCritter(){
      const p = palettes[randi(0, palettes.length-1)];
      const s = rand(1.8, 2.8); // slightly bigger for visibility
      const y = skyLaneY();
      const dir = Math.random() < 0.5 ? -1 : 1;
      world.critters.push({
        x: dir > 0 ? rand(-140, -30) : rand(W+30, W+140),
        y,
        vx: dir * rand(0.9, 2.1),
        hop: rand(0, Math.PI*2),
        s,
        p,
        type: randi(0,2)
      });
    }

    function addSparkle(x,y){
      for(let i=0;i<10;i++){
        world.sparkles.push({
          x: x + rand(-10, 10),
          y: y + rand(-10, 10),
          vx: rand(-0.8, 0.8),
          vy: rand(-1.4, -0.3),
          life: rand(18, 44),
          c: ["#7df3ff","#ff6ad5","#63ffb5","#ffd56a"][randi(0,3)]
        });
      }
    }

    // Seed world
    for(let i=0;i<12;i++) addCloud();
    for(let i=0;i<10;i++) addCritter();

    function pxRect(x,y,w,h,c){
      ctx.fillStyle=c;
      ctx.fillRect(Math.round(x),Math.round(y),Math.round(w),Math.round(h));
    }

    function drawSky(){
      // stars
      ctx.globalAlpha = 0.9;
      for(let i=0;i<70;i++){
        const x = (i*97) % W;
        const y = (i*53) % Math.max(1, Math.floor(H*0.55));
        const tw = ((i*17) % 3) + 1;
        ctx.fillStyle = i%7===0 ? "rgba(125,243,255,.75)" : "rgba(255,255,255,.38)";
        ctx.fillRect(x, y, tw, tw);
      }
      ctx.globalAlpha = 1;

      // a subtle "sky lane" glow so the critters pop
      const laneY = Math.max(80, Math.floor(H*0.22));
      ctx.fillStyle = "rgba(125,243,255,.08)";
      ctx.fillRect(0, laneY, W, 3);
      ctx.fillStyle = "rgba(255,106,213,.06)";
      ctx.fillRect(0, laneY+6, W, 2);
    }

    function drawCloud(cl){
      const x = cl.x, y = cl.y, s = cl.s;
      ctx.globalAlpha = 0.62;
      pxRect(x, y, 26*s, 10*s, "rgba(255,255,255,.10)");
      pxRect(x+10*s, y-6*s, 34*s, 12*s, "rgba(255,255,255,.10)");
      pxRect(x+32*s, y, 24*s, 10*s, "rgba(255,255,255,.10)");
      ctx.globalAlpha = 1;
    }

    function drawGround(){
      const gy = Math.floor(H * 0.78);
      ctx.globalAlpha = 0.95;
      pxRect(0, gy, W, H-gy, "rgba(7,10,24,.88)");
      pxRect(0, gy, W, 3, "rgba(125,243,255,.22)");
      for(let x=0;x<W;x+=34){
        const y = gy + randi(10, 60);
        pxRect(x + randi(-2,10), y, 2, 2, "rgba(255,255,255,.12)");
        pxRect(x + randi(8,18), y + randi(-6,8), 3, 3, "rgba(255,106,213,.10)");
      }
      ctx.globalAlpha = 1;
    }

    function drawCritter(c){
      const x = c.x, y = c.y, s = c.s;
      const p = c.p;
      const hop = Math.sin(c.hop) * 2.6;

      const baseY = y + hop;
      const outline = "rgba(0,0,0,.28)";

      // shadow
      ctx.globalAlpha = 0.35;
      pxRect(x + 8*s, baseY + 26*s, 18*s, 3*s, "rgba(0,0,0,.35)");
      ctx.globalAlpha = 1;

      // body
      pxRect(x + 8*s, baseY + 10*s, 18*s, 18*s, p.body);
      // belly highlight
      pxRect(x + 12*s, baseY + 16*s, 10*s, 9*s, "rgba(255,255,255,.12)");

      // eyes
      pxRect(x + 12*s, baseY + 16*s, 2*s, 2*s, p.eye);
      pxRect(x + 20*s, baseY + 16*s, 2*s, 2*s, p.eye);

      // blush
      pxRect(x + 10*s, baseY + 20*s, 2*s, 1*s, p.blush);
      pxRect(x + 22*s, baseY + 20*s, 2*s, 1*s, p.blush);

      // feet
      pxRect(x + 10*s, baseY + 28*s, 5*s, 2*s, p.accent);
      pxRect(x + 19*s, baseY + 28*s, 5*s, 2*s, p.accent);

      // ears/extras
      if(c.type === 0){
        pxRect(x + 10*s, baseY + 2*s, 4*s, 10*s, p.accent);
        pxRect(x + 20*s, baseY + 2*s, 4*s, 10*s, p.accent);
        pxRect(x + 11*s, baseY + 4*s, 2*s, 6*s, "rgba(255,255,255,.14)");
        pxRect(x + 21*s, baseY + 4*s, 2*s, 6*s, "rgba(255,255,255,.14)");
      } else if(c.type === 1){
        pxRect(x + 9*s, baseY + 6*s, 4*s, 4*s, p.accent);
        pxRect(x + 21*s, baseY + 6*s, 4*s, 4*s, p.accent);
        pxRect(x + 26*s, baseY + 18*s, 6*s, 3*s, p.accent);
        pxRect(x + 30*s, baseY + 16*s, 2*s, 2*s, p.accent);
      } else {
        pxRect(x + 16*s, baseY + 5*s, 2*s, 4*s, p.accent);
        pxRect(x + 18*s, baseY + 6*s, 2*s, 3*s, p.accent);
        pxRect(x + 15*s, baseY + 18*s, 5*s, 2*s, "rgba(255,213,106,.95)");
      }

      // outline pixels
      ctx.globalAlpha = 0.28;
      pxRect(x + 8*s, baseY + 10*s, 18*s, 1*s, outline);
      pxRect(x + 8*s, baseY + 27*s, 18*s, 1*s, outline);
      ctx.globalAlpha = 1;
    }

    function drawSparkles(){
      for(const sp of world.sparkles){
        ctx.globalAlpha = Math.min(1, sp.life / 20);
        pxRect(sp.x, sp.y, 2, 2, sp.c);
        if(sp.life % 3 === 0) pxRect(sp.x+2, sp.y, 1, 1, "rgba(255,255,255,.55)");
        ctx.globalAlpha = 1;
      }
    }

    let last = performance.now();
    let fpsAcc = 0, fpsN = 0, fpsLast = performance.now();

    function tick(now){
      const dt = Math.min(33, now - last);
      last = now;

      ctx.clearRect(0,0,W,H);

      drawSky();

      for(const cl of world.clouds){
        cl.x += cl.v * (dt/16);
        if(cl.x > W + 160) cl.x = -180;
        drawCloud(cl);
      }

      drawGround();

      if(world.showAnimals){
        for(const c of world.critters){
          c.x += c.vx * world.zoomies * (dt/16);
          c.hop += (0.08 * world.zoomies) * (dt/16);

          if(c.vx > 0 && c.x > W + 160) c.x = -160;
          if(c.vx < 0 && c.x < -180) c.x = W + 180;

          drawCritter(c);
        }
        world.zoomies += (1.0 - world.zoomies) * 0.02;
      }

      for(let i=world.sparkles.length-1;i>=0;i--){
        const sp = world.sparkles[i];
        sp.x += sp.vx * (dt/16);
        sp.y += sp.vy * (dt/16);
        sp.vy += 0.03 * (dt/16);
        sp.life -= 1.2 * (dt/16);
        if(sp.life <= 0) world.sparkles.splice(i,1);
      }
      drawSparkles();

      fpsAcc += 1000 / Math.max(1, dt);
      fpsN++;
      if(now - fpsLast > 600){
        $("#fps").textContent = Math.round(fpsAcc / fpsN) + " fps";
        fpsAcc = 0; fpsN = 0; fpsLast = now;
      }

      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);

    window.addEventListener("pointerdown", (e)=>{
      if (e.target.closest && e.target.closest(".gift, button, a, input")) return;
      addSparkle(e.clientX, e.clientY);
      if(window.confetti){
        confetti({ particleCount: 18, spread: 40, origin: { x: e.clientX / W, y: e.clientY / H } });
      }
    }, { passive:true });

    function boostZoomies(mult=1.2){
      world.zoomies = Math.min(2.2, world.zoomies * mult);
    }

    // Buttons
    $("#btnConfetti").addEventListener("click", ()=>{
      if(window.confetti){
        confetti({ particleCount: 170, spread: 70, origin: { y: 0.75 } });
        toast("Confetti deployed üéâ");
      } else toast("Confetti lib didn‚Äôt load üòÖ");
    });

    $("#btnFeed").addEventListener("click", ()=>{
      boostZoomies(1.6);
      addSparkle(rand(40, W-40), rand(90, H*0.35));
      if(window.confetti) confetti({ particleCount: 60, spread: 55, origin: { y: 0.25 } });
      toast("Critters fed üç¨");
    });

    $("#btnToggleAnimals").addEventListener("click", ()=>{
      world.showAnimals = !world.showAnimals;
      toast(world.showAnimals ? "Animals ON üêæ" : "Animals OFF üí§");
      $("#btnToggleAnimals").textContent = world.showAnimals ? "üêæ Toggle animals" : "üí§ Toggle animals";
    });

    // Premium motion (optional GSAP)
    function gsapWiggle(){
      if(!window.gsap) return;
      gsap.to(".titleCard", { duration: 3.2, y: 4, ease: "sine.inOut", yoyo:true, repeat:-1 });
      gsap.to(".controls", { duration: 4.0, y: -3, ease: "sine.inOut", yoyo:true, repeat:-1 });
    }

    window.addEventListener("load", ()=>{
      updateLinkText();
      gsapWiggle();
      const first = $(".gift");
      if(first) selectGift(first);
    });
  </script>
</body>
</html>
